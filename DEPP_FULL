

## Import

import delimited C:\Users\Antoine\Desktop\DEPP\s97.csv
save "C:\Users\Antoine\Desktop\DEPP\s97.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s98.csv
save "C:\Users\Antoine\Desktop\DEPP\s98.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s99.csv
save "C:\Users\Antoine\Desktop\DEPP\s99.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s00.csv
save "C:\Users\Antoine\Desktop\DEPP\s00.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s01.csv
save "C:\Users\Antoine\Desktop\DEPP\s01.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s02.csv
save "C:\Users\Antoine\Desktop\DEPP\s02.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s03.csv
save "C:\Users\Antoine\Desktop\DEPP\s03.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s04.csv
save "C:\Users\Antoine\Desktop\DEPP\s04.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s05.csv
save "C:\Users\Antoine\Desktop\DEPP\s05.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s06.csv
save "C:\Users\Antoine\Desktop\DEPP\s06.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s07.csv
save "C:\Users\Antoine\Desktop\DEPP\s07.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s08.csv
save "C:\Users\Antoine\Desktop\DEPP\s08.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s09.csv
save "C:\Users\Antoine\Desktop\DEPP\s09.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s10.csv
save "C:\Users\Antoine\Desktop\DEPP\s10.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s11.csv
save "C:\Users\Antoine\Desktop\DEPP\s11.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s12.csv
save "C:\Users\Antoine\Desktop\DEPP\s12.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s13.csv
save "C:\Users\Antoine\Desktop\DEPP\s13.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s14.csv
save "C:\Users\Antoine\Desktop\DEPP\s14.dta"

## Gestion des incohérences de format 

use "C:\Users\Antoine\Desktop\DEPP\s07.dta"

tab franaistranger

destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s07.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s08.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s08.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s09.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s09.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s10.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s10.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s11.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s11.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s12.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s12.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s13.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s13.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s14.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s14.dta", replace
clear

## Fusion des fichiers par année

use "C:\Users\Antoine\Desktop\DEPP\s97.dta", clear

append using "C:\Users\Antoine\Desktop\DEPP\s98.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s99.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s00.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s01.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s02.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s03.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s04.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s05.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s06.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s07.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s08.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s09.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s10.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s11.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s12.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s13.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s14.dta"

## Sauvegarde

save "C:\Users\Antoine\Desktop\DEPP\depp.dta"

## Renommage des variables

ren originesocialedtaille pcs8
ren pcs8 pcs24
ren originesociale8groupes pcs8
ren franaistranger natio
ren sriedubaccalauratlibc serie
ren numrodtablissement numetan
ren numetan numetab
ren communeetarrondissement com
ren secteurdenseignement secteur
ren etablissementsensible sensible
ren nombredinscrits inscrits
ren nombredeprsents presents
ren nombretotaldadmis admis
ren nombredadmissansmention nomention
ren nombredadmismentionab ab
ren nombredadmismentionb b
ren nombredadmismentiontb tb
ren nombredtablissements nbetab

## Id Unique Lycée x Session 

egen id_etab = concat(numetab session), punct(_)


## Compteur des résultats

gen num = 1

bysort id_etab : egen  pond_admis = total(admis)
bysort id_etab : egen  pond_inscrits = total(inscrits)
bysort id_etab : egen  pond_presents = total(presents)
bysort id_etab : egen  pond_nomention = total(nomention)
bysort id_etab : egen  pond_ab = total(ab)
bysort id_etab : egen  pond_b = total(b)
bysort id_etab : egen  pond_tb = total(tb)

order pond_inscrits pond_presents, after( num )

## Taux de réussite et mention

gen psucc = ( pond_admis / pond_inscrits ) * 100
gen nm_adm = ( pond_nomention / pond_admis ) * 100
gen ab_adm = ( pond_ab / pond_admis ) * 100
gen b_adm = ( pond_b / pond_admis ) * 100
gen tb_adm = ( pond_tb / pond_admis ) * 100

## Gestion des valeurs manquantes

replace nm_adm = 0 if nm_adm == .
replace ab_adm = 0 if ab_adm == .
replace b_adm = 0 if b_adm == .
replace tb_adm = 0 if tb_adm == .

## Identifiant par mention, par lycée et par session 

egen id_etab2 = concat(numetab session serie ), punct(_)

bysort id_etab2 : egen  ser_admis = total(admis)
bysort id_etab2 : egen  ser_inscrits = total(inscrits)
bysort id_etab2 : egen  ser_presents = total(presents)
bysort id_etab2 : egen  ser_nomention = total(nomention)
bysort id_etab2 : egen  ser_ab = total(ab)
bysort id_etab2 : egen  ser_b = total(b)
bysort id_etab2 : egen  ser_tb = total(tb)

gen ser_succ = ( ser_admis / ser_inscrits ) * 100
gen ser_nm_adm = ( ser_nomention / ser_admis ) * 100
gen ser_ab_adm = ( ser_ab / ser_admis ) * 100
gen ser_b_adm = ( ser_b / ser_admis ) * 100
gen ser_tb_adm = ( ser_tb / ser_admis ) * 100

replace ser_nm_adm = 0 if ser_nm_adm == .
replace ser_ab_adm = 0 if ser_ab_adm == .
replace ser_b_adm = 0 if ser_b_adm == .
replace ser_tb_adm = 0 if ser_tb_adm == .

## TODO : PCS

use "C:\Users\Antoine\Desktop\DEPP\depp.dta", clear

bysort id_etab pcs8 : egen test = total(inscrits)
bysort id_etab pcs24 : egen test24 = total(inscrits)

gen cs1 = test if pcs8 == 1
gen cs2 = test if pcs8 == 2
gen cs3 = test if pcs8 == 3
gen cs4 = test if pcs8 == 4
gen cs5 = test if pcs8 == 5
gen cs6 = test if pcs8 == 6
gen cs7 = test if pcs8 == 7
gen cs8 = test if pcs8 == 8
gen cs9 = test if pcs8 == 9

gen gcs10= test if pcs24 ==10
gen gcs20= test if pcs24 ==20
gen gcs21= test if pcs24 ==21
gen gcs22= test if pcs24 ==22
gen gcs23= test if pcs24 ==23
gen gcs30= test if pcs24 ==30
gen gcs31= test if pcs24 ==31
gen gcs33= test if pcs24 ==33
gen gcs34= test if pcs24 ==34
gen gcs35= test if pcs24 ==35
gen gcs37= test if pcs24 ==37
gen gcs38= test if pcs24 ==38
gen gcs40= test if pcs24 ==40
gen gcs42= test if pcs24 ==42
gen gcs43= test if pcs24 ==43
gen gcs44= test if pcs24 ==44
gen gcs45= test if pcs24 ==45
gen gcs46= test if pcs24 ==46
gen gcs47= test if pcs24 ==47
gen gcs48= test if pcs24 ==48
gen gcs50= test if pcs24 ==50
gen gcs52= test if pcs24 ==52
gen gcs53= test if pcs24 ==53
gen gcs54= test if pcs24 ==54
gen gcs55= test if pcs24 ==55
gen gcs56= test if pcs24 ==56
gen gcs60= test if pcs24 ==60
gen gcs61= test if pcs24 ==61
gen gcs66= test if pcs24 ==66
gen gcs69= test if pcs24 ==69
gen gcs70= test if pcs24 ==70
gen gcs71= test if pcs24 ==71
gen gcs72= test if pcs24 ==72
gen gcs73= test if pcs24 ==73
gen gcs76= test if pcs24 ==76
gen gcs80= test if pcs24 ==80
gen gcs81= test if pcs24 ==81
gen gcs82= test if pcs24 ==82
gen gcs99= test if pcs24 ==99

