

## Import

import delimited C:\Users\Antoine\Desktop\DEPP\s97.csv
save "C:\Users\Antoine\Desktop\DEPP\s97.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s98.csv
save "C:\Users\Antoine\Desktop\DEPP\s98.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s99.csv
save "C:\Users\Antoine\Desktop\DEPP\s99.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s00.csv
save "C:\Users\Antoine\Desktop\DEPP\s00.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s01.csv
save "C:\Users\Antoine\Desktop\DEPP\s01.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s02.csv
save "C:\Users\Antoine\Desktop\DEPP\s02.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s03.csv
save "C:\Users\Antoine\Desktop\DEPP\s03.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s04.csv
save "C:\Users\Antoine\Desktop\DEPP\s04.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s05.csv
save "C:\Users\Antoine\Desktop\DEPP\s05.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s06.csv
save "C:\Users\Antoine\Desktop\DEPP\s06.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s07.csv
save "C:\Users\Antoine\Desktop\DEPP\s07.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s08.csv
save "C:\Users\Antoine\Desktop\DEPP\s08.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s09.csv
save "C:\Users\Antoine\Desktop\DEPP\s09.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s10.csv
save "C:\Users\Antoine\Desktop\DEPP\s10.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s11.csv
save "C:\Users\Antoine\Desktop\DEPP\s11.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s12.csv
save "C:\Users\Antoine\Desktop\DEPP\s12.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s13.csv
save "C:\Users\Antoine\Desktop\DEPP\s13.dta"
clear
import delimited C:\Users\Antoine\Desktop\DEPP\s14.csv
save "C:\Users\Antoine\Desktop\DEPP\s14.dta"

## Gestion des incohérences de format 

use "C:\Users\Antoine\Desktop\DEPP\s07.dta"

tab franaistranger

destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s07.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s08.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s08.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s09.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s09.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s10.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s10.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s11.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s11.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s12.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s12.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s13.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s13.dta", replace
use "C:\Users\Antoine\Desktop\DEPP\s14.dta"
destring franaistranger, replace force
save "C:\Users\Antoine\Desktop\DEPP\s14.dta", replace
clear

## Fusion des fichiers par année

use "C:\Users\Antoine\Desktop\DEPP\s97.dta", clear

append using "C:\Users\Antoine\Desktop\DEPP\s98.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s99.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s00.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s01.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s02.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s03.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s04.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s05.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s06.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s07.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s08.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s09.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s10.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s11.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s12.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s13.dta"
append using "C:\Users\Antoine\Desktop\DEPP\s14.dta"

## Sauvegarde

save "C:\Users\Antoine\Desktop\DEPP\depp.dta"

## Renommage des variables

ren originesocialedtaille pcs8
ren pcs8 pcs24
ren originesociale8groupes pcs8
ren franaistranger natio
ren sriedubaccalauratlibc serie
ren numrodtablissement numetan
ren numetan numetab
ren communeetarrondissement com
ren secteurdenseignement secteur
ren etablissementsensible sensible
ren nombredinscrits inscrits
ren nombredeprsents presents
ren nombretotaldadmis admis
ren nombredadmissansmention nomention
ren nombredadmismentionab ab
ren nombredadmismentionb b
ren nombredadmismentiontb tb
ren nombredtablissements nbetab

## Id Unique Lycée x Session 

egen id_etab = concat(numetab session), punct(_)


## Compteur des résultats

gen num = 1

bysort id_etab : egen  pond_admis = total(admis)
bysort id_etab : egen  pond_inscrits = total(inscrits)
bysort id_etab : egen  pond_presents = total(presents)
bysort id_etab : egen  pond_nomention = total(nomention)
bysort id_etab : egen  pond_ab = total(ab)
bysort id_etab : egen  pond_b = total(b)
bysort id_etab : egen  pond_tb = total(tb)

order pond_inscrits pond_presents, after( num )

## Taux de réussite et mention

gen psucc = ( pond_admis / pond_inscrits ) * 100
gen nm_adm = ( pond_nomention / pond_admis ) * 100
gen ab_adm = ( pond_ab / pond_admis ) * 100
gen b_adm = ( pond_b / pond_admis ) * 100
gen tb_adm = ( pond_tb / pond_admis ) * 100

## Gestion des valeurs manquantes

replace nm_adm = 0 if nm_adm == .
replace ab_adm = 0 if ab_adm == .
replace b_adm = 0 if b_adm == .
replace tb_adm = 0 if tb_adm == .

## Identifiant par mention, par lycée et par session 

egen id_etab2 = concat(numetab session serie ), punct(_)

bysort id_etab2 : egen  ser_admis = total(admis)
bysort id_etab2 : egen  ser_inscrits = total(inscrits)
bysort id_etab2 : egen  ser_presents = total(presents)
bysort id_etab2 : egen  ser_nomention = total(nomention)
bysort id_etab2 : egen  ser_ab = total(ab)
bysort id_etab2 : egen  ser_b = total(b)
bysort id_etab2 : egen  ser_tb = total(tb)

gen ser_succ = ( ser_admis / ser_inscrits ) * 100
gen ser_nm_adm = ( ser_nomention / ser_admis ) * 100
gen ser_ab_adm = ( ser_ab / ser_admis ) * 100
gen ser_b_adm = ( ser_b / ser_admis ) * 100
gen ser_tb_adm = ( ser_tb / ser_admis ) * 100

replace ser_nm_adm = 0 if ser_nm_adm == .
replace ser_ab_adm = 0 if ser_ab_adm == .
replace ser_b_adm = 0 if ser_b_adm == .
replace ser_tb_adm = 0 if ser_tb_adm == .

## TODO : PCS

use "C:\Users\Antoine\Desktop\DEPP\depp.dta", clear

bysort id_etab : egen cs1 = total(inscrits) if pcs8 == 1
bysort id_etab : egen cs2 = total(inscrits) if pcs8 == 2
bysort id_etab : egen cs3 = total(inscrits) if pcs8 == 3
bysort id_etab : egen cs4 = total(inscrits) if pcs8 == 4
bysort id_etab : egen cs5 = total(inscrits) if pcs8 == 5
bysort id_etab : egen cs6 = total(inscrits) if pcs8 == 6
bysort id_etab : egen cs7 = total(inscrits) if pcs8 == 7
bysort id_etab : egen cs8 = total(inscrits) if pcs8 == 8
bysort id_etab : egen cs9 = total(inscrits) if pcs8 == 9

## Cylindrage des données 

egen test = group ( id_etab )

xfill cs1, i(test)
xfill cs2, i(test)
xfill cs3, i(test)
xfill cs4, i(test)
xfill cs5, i(test)
xfill cs6, i(test)
xfill cs7, i(test)
xfill cs8, i(test)
xfill cs9, i(test)

replace cs1 = 0 if cs1 == .
replace cs2 = 0 if cs2 == .
replace cs3 = 0 if cs3 == .
replace cs4 = 0 if cs4 == .
replace cs5 = 0 if cs5 == .
replace cs6 = 0 if cs6 == .
replace cs7 = 0 if cs7 == .
replace cs8 = 0 if cs8 == .
replace cs9 = 0 if cs9 == .

## Boucle pourcentages (CS8)

foreach x of varlist (cs1-cs9) {
gen p_`x' = (`x' / pond_inscrits) * 100
}

## Controle

egen control_1 = rowtotal (p_cs1-p_cs9)

drop control_1
